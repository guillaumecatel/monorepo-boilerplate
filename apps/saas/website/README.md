# ğŸŒ Astro Website

> A production-ready Astro 5 website with SSR, type-safe i18n, and optimized for 100% Lighthouse scores.

## ğŸ“– Table of Contents

- [Overview](#-overview)
- [Features](#-features)
- [Getting Started](#-getting-started)
- [Project Structure](#-project-structure)
- [Available Scripts](#-available-scripts)
- [Pages](#-pages)
- [Components](#-components)
- [Layouts](#-layouts)
- [Internationalization](#-internationalization)
- [Content Management](#-content-management)
- [Styling](#-styling)
- [Security](#-security)
- [SEO & Performance](#-seo--performance)
- [Testing](#-testing)
- [Production Deployment](#-production-deployment)
- [Configuration](#ï¸-configuration)

## ğŸ¯ Overview

This is an **example application** generated from the `astro-website` template. It demonstrates a production-ready Astro website with:

- **Server-Side Rendering** via Express.js
- **Type-safe internationalization** with Paraglide.js
- **Modern styling** with Tailwind CSS 4
- **Security hardening** with Helmet.js and CSP
- **Perfect accessibility** compliance

> **Note:** This app is excluded when bootstrapping a new project via degit. Use `pnpm gen` at the monorepo root to create your own instance.

## âœ¨ Features

### Core Stack

| Technology                                                 | Purpose                |
| ---------------------------------------------------------- | ---------------------- |
| [Astro 5](https://astro.build/)                            | Web framework with SSR |
| [Express.js 5](https://expressjs.com/)                     | Production server      |
| [Paraglide.js](https://inlang.com/m/gerre34r/paraglide-js) | Type-safe i18n         |
| [Tailwind CSS 4](https://tailwindcss.com/)                 | Utility-first styling  |
| [TypeScript](https://www.typescriptlang.org/)              | Type safety            |

### Production Ready

- ğŸ”’ **Security Headers** - Helmet.js with Content Security Policy
- âš¡ **Compression** - Gzip & Brotli compression for optimal transfer
- ğŸ¯ **SEO Optimized** - Meta tags, Open Graph, sitemap, robots.txt
- ğŸ“Š **100% Lighthouse** - Performance, Accessibility, SEO, Best Practices
- ğŸ§ª **Testing** - Vitest with Astro Container API

### Developer Experience

- ğŸ”¥ **Hot Module Replacement** - Instant updates via Vite
- ğŸ“ **Content Collections** - Type-safe markdown management
- ğŸ­ **Modular Layouts** - Flexible layout system with partials
- ğŸ§© **Accessible Components** - Pre-built WCAG-compliant components

## ğŸš€ Getting Started

### Prerequisites

Ensure you're at the **monorepo root** with dependencies installed:

```bash
# From monorepo root
nvm use
pnpm i
```

### Development

```bash
# Start development server (from monorepo root)
pnpm dev --filter=astro-website

# Or navigate to this directory
cd apps/astro-website
pnpm dev
```

The development server starts at `http://localhost:4321`

### Production Build

```bash
# Build for production
pnpm build --filter=astro-website

# Start production server
pnpm start --filter=astro-website
```

## ğŸ“‚ Project Structure

```text
apps/astro-website/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ icons/                    # Favicons and app icons
â”‚   â””â”€â”€ images/                   # Static images
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/               # Reusable Astro components
â”‚   â”‚   â”œâ”€â”€ AccessibilityShortcuts.astro
â”‚   â”‚   â”œâ”€â”€ Footer.astro
â”‚   â”‚   â””â”€â”€ Header.astro
â”‚   â”‚
â”‚   â”œâ”€â”€ content/                  # Content collections
â”‚   â”‚   â”œâ”€â”€ config.ts             # Collection schemas
â”‚   â”‚   â””â”€â”€ pages/                # Markdown content (fr/en)
â”‚   â”‚       â”œâ”€â”€ about-fr.md
â”‚   â”‚       â”œâ”€â”€ about-en.md
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ i18n/                     # Generated by Paraglide.js
â”‚   â”‚   â”œâ”€â”€ messages.js           # Compiled translations
â”‚   â”‚   â””â”€â”€ runtime.js            # i18n runtime
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/                  # Page layouts
â”‚   â”‚   â”œâ”€â”€ Layout.astro          # Main layout
â”‚   â”‚   â””â”€â”€ partials/             # Layout components
â”‚   â”‚       â”œâ”€â”€ Body.astro
â”‚   â”‚       â”œâ”€â”€ Document.astro
â”‚   â”‚       â”œâ”€â”€ Head.astro
â”‚   â”‚       â””â”€â”€ Html.astro
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/               # Astro middleware
â”‚   â”‚   â”œâ”€â”€ index.ts              # Middleware entry
â”‚   â”‚   â””â”€â”€ paraglide.ts          # i18n routing middleware
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                    # File-based routing
â”‚   â”‚   â”œâ”€â”€ index.astro           # Home page
â”‚   â”‚   â”œâ”€â”€ about.astro           # About page
â”‚   â”‚   â”œâ”€â”€ accessibility.astro   # Accessibility statement
â”‚   â”‚   â”œâ”€â”€ cookie-policy.astro   # Cookie policy
â”‚   â”‚   â”œâ”€â”€ privacy-policy.astro  # Privacy policy
â”‚   â”‚   â”œâ”€â”€ terms-of-service.astro
â”‚   â”‚   â”œâ”€â”€ 404.astro             # Error page
â”‚   â”‚   â”œâ”€â”€ manifest.webmanifest.ts
â”‚   â”‚   â”œâ”€â”€ robots.txt.ts
â”‚   â”‚   â””â”€â”€ sitemap.xml.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                  # TypeScript schemas
â”‚   â”‚   â”œâ”€â”€ index.ts              # Schema exports
â”‚   â”‚   â””â”€â”€ pages.ts              # Page content schema
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ global.css            # Tailwind imports
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                    # TypeScript types
â”‚   â”œâ”€â”€ utils/                    # Utility functions
â”‚   â”‚   â””â”€â”€ sitemap.ts            # Sitemap helpers
â”‚   â”‚
â”‚   â””â”€â”€ config.ts                 # App configuration
â”‚
â”œâ”€â”€ tests/                        # Test files
â”‚   â”œâ”€â”€ setup-tests.ts            # Test setup
â”‚   â”œâ”€â”€ components/               # Component tests
â”‚   â”œâ”€â”€ layouts/                  # Layout tests
â”‚   â”œâ”€â”€ middleware/               # Middleware tests
â”‚   â”œâ”€â”€ pages/                    # Page tests
â”‚   â”œâ”€â”€ schemas/                  # Schema tests
â”‚   â”œâ”€â”€ types/                    # Type tests
â”‚   â””â”€â”€ utils/                    # Utility tests
â”‚
â”œâ”€â”€ astro.config.ts               # Astro configuration
â”œâ”€â”€ routes.ts                     # i18n route mappings
â”œâ”€â”€ server.mjs                    # Express production server
â”œâ”€â”€ tsconfig.json                 # TypeScript configuration
â”œâ”€â”€ tsconfig.test.json            # TypeScript test configuration
â””â”€â”€ vitest.config.ts              # Vitest configuration
```

## ğŸ“œ Available Scripts

| Command          | Description                         |
| ---------------- | ----------------------------------- |
| `pnpm dev`       | Start development server with HMR   |
| `pnpm build`     | Build for production                |
| `pnpm start`     | Start production server (port 3000) |
| `pnpm typecheck` | Run Astro type checking             |
| `pnpm test`      | Run tests with Vitest               |
| `pnpm clean`     | Remove build artifacts and cache    |

## ğŸ“„ Pages

### Included Pages

| Page             | Route (FR)                      | Route (EN)             |
| ---------------- | ------------------------------- | ---------------------- |
| Home             | `/`                             | `/en`                  |
| About            | `/a-propos`                     | `/en/about`            |
| Accessibility    | `/accessibilite`                | `/en/accessibility`    |
| Privacy Policy   | `/politique-de-confidentialite` | `/en/privacy-policy`   |
| Terms of Service | `/conditions-d-utilisation`     | `/en/terms-of-service` |
| Cookie Policy    | `/politique-de-cookies`         | `/en/cookie-policy`    |
| 404 Error        | `/404`                          | `/en/404`              |

### Generated Endpoints

| Endpoint                | Description         |
| ----------------------- | ------------------- |
| `/sitemap.xml`          | Dynamic XML sitemap |
| `/robots.txt`           | Robots directives   |
| `/manifest.webmanifest` | PWA web manifest    |

## ğŸ§© Components

### AccessibilityShortcuts

Skip links for keyboard navigation, placed at the top of the page:

```astro
---
import AccessibilityShortcuts from '@/components/AccessibilityShortcuts.astro'
---

<AccessibilityShortcuts />
```

### Header

Responsive header with navigation and language switcher:

```astro
---
import Header from '@/components/Header.astro'
---

<Header />
```

### Footer

Footer with legal links and copyright:

```astro
---
import Footer from '@/components/Footer.astro'
---

<Footer />
```

## ğŸ­ Layouts

### Main Layout

The `Layout.astro` component wraps all pages with consistent structure:

```astro
---
import Layout from '@/layouts/Layout.astro'
---

<Layout
  title='Page Title'
  description='Page description for SEO'
  ogImage='/images/og-image.png'>
  <main id='main-content'>
    <!-- Page content -->
  </main>
</Layout>
```

### Layout Partials

Modular layout components in `layouts/partials/`:

| Partial          | Purpose                                    |
| ---------------- | ------------------------------------------ |
| `Html.astro`     | HTML tag with lang attribute               |
| `Head.astro`     | Meta tags, Open Graph, styles              |
| `Body.astro`     | Body wrapper with accessibility attributes |
| `Document.astro` | Full document structure                    |

## ğŸŒ Internationalization

### Supported Languages

| Language | Code | URL Pattern | Default |
| -------- | ---- | ----------- | ------- |
| French   | `fr` | `/` (root)  | âœ…      |
| English  | `en` | `/en/*`     |         |

### How It Works

1. **Translations** are managed at monorepo level in `../../translations`
2. **Paraglide.js** compiles translations to `src/i18n`
3. **Middleware** handles language detection and routing
4. **Routes** are defined in `routes.ts` with localized patterns

### Route Configuration

```typescript
// routes.ts
export default [
  {
    pattern: '/about',
    localized: [
      ['fr', '/a-propos'],
      ['en', '/en/about'],
    ],
  },
  // ...
]
```

### Using Translations

```astro
---
import * as m from '@/i18n/messages'
import { languageTag } from '@/i18n/runtime'
---

<h1>{m.page_title()}</h1>
<p>Current language: {languageTag()}</p>
```

### Adding a New Language

1. Add the locale in `../../.inlang/settings.json`
2. Create translation file `../../translations/{locale}.json`
3. Add localized routes in `routes.ts`
4. Run `pnpm build` to regenerate i18n files

## ğŸ“ Content Management

Content is managed via **Astro Content Collections** with type-safe schemas.

### Content Structure

```text
src/content/
â”œâ”€â”€ config.ts           # Collection definitions
â””â”€â”€ pages/              # Markdown files
    â”œâ”€â”€ about-fr.md     # French version
    â”œâ”€â”€ about-en.md     # English version
    â””â”€â”€ ...
```

### File Naming Convention

Files follow the pattern: `{slug}-{lang}.md`

### Frontmatter Schema

```markdown
---
title: About Us
description: Learn more about our company
---

Your markdown content here...
```

### Accessing Content

```astro
---
import { getCollection } from 'astro:content'

const pages = await getCollection('pages')
const aboutFr = pages.find((p) => p.id === 'about-fr')
---
```

## ğŸ¨ Styling

### Tailwind CSS 4

This app uses **Tailwind CSS 4** with the shared monorepo configuration:

```css
/* src/styles/global.css */
@import 'tailwindcss';
@import 'tailwind-config';
```

### Features

- **CSS-first configuration** - No JavaScript config file
- **Shared config** - Uses `tailwind-config` package from monorepo
- **CSS Layers** - Organized base, components, utilities
- **Dark mode ready** - Via `prefers-color-scheme`

### Usage

```astro
<div class='flex items-center justify-between bg-white p-4 dark:bg-gray-900'>
  <h1 class='text-2xl font-bold text-gray-900 dark:text-white'>Hello World</h1>
</div>
```

## ğŸ”’ Security

The production server (`server.mjs`) includes comprehensive security headers:

### Helmet.js Configuration

| Header                    | Purpose                       |
| ------------------------- | ----------------------------- |
| Content-Security-Policy   | Prevents XSS attacks          |
| X-Content-Type-Options    | Prevents MIME sniffing        |
| X-Frame-Options           | Prevents clickjacking         |
| Strict-Transport-Security | Enforces HTTPS                |
| Referrer-Policy           | Controls referrer information |

### Content Security Policy

```javascript
contentSecurityPolicy: {
  directives: {
    defaultSrc: ["'self'"],
    scriptSrc: ["'self'", "'unsafe-inline'", 'data:'],
    imgSrc: ["'self'", 'data:', 'blob:'],
    connectSrc: ["'self'"],
  },
}
```

### Permissions Policy

Controls browser feature access:

```javascript
permissionsPolicy({
  features: {
    fullscreen: ['self'],
  },
})
```

### Additional Security

- **x-powered-by disabled** - Hides Express fingerprint
- **UTF-8 charset enforced** - Prevents encoding attacks
- **Static file caching** - 1 year with immutable flag

## ğŸ“Š SEO & Performance

### SEO Features

| Feature             | Implementation                 |
| ------------------- | ------------------------------ |
| Meta tags           | Dynamic per page via Layout    |
| Open Graph          | Full OG metadata support       |
| Twitter Cards       | Summary large image cards      |
| Canonical URLs      | Automatic canonical links      |
| Language alternates | hreflang tags for i18n         |
| Sitemap             | Dynamic XML sitemap generation |
| Robots.txt          | Configurable crawl directives  |

### Performance Optimizations

| Optimization       | Tool/Technique                        |
| ------------------ | ------------------------------------- |
| SSR                | Server-side rendering for fast TTFB   |
| Compression        | Gzip & Brotli via Express middleware  |
| Asset optimization | @playform/compress + astro-compressor |
| Static caching     | 1 year cache with immutable flag      |
| Code splitting     | Automatic via Astro                   |
| CSS optimization   | Tailwind CSS purging                  |

### Lighthouse Scores

This template is optimized to achieve:

| Metric         | Score |
| -------------- | ----- |
| Performance    | 100   |
| Accessibility  | 100   |
| Best Practices | 100   |
| SEO            | 100   |

## ğŸ§ª Testing

Tests are written using **Vitest** with Astro's Container API.

### Running Tests

```bash
# Run all tests
pnpm test

# Watch mode
pnpm test -- --watch

# With coverage
pnpm test -- --coverage
```

### Test Structure

```text
tests/
â”œâ”€â”€ setup-tests.ts      # Global test setup
â”œâ”€â”€ components/         # Component tests
â”œâ”€â”€ layouts/            # Layout tests
â”œâ”€â”€ middleware/         # Middleware tests
â”œâ”€â”€ pages/              # Page rendering tests
â”œâ”€â”€ schemas/            # Schema validation tests
â”œâ”€â”€ types/              # Type tests
â””â”€â”€ utils/              # Utility function tests
```

### Example Test

```typescript
import { experimental_AstroContainer as AstroContainer } from 'astro/container'
import { describe, expect, it } from 'vitest'

import Index from '@/pages/index.astro'

describe('Index page', () => {
  it('should render the home page', async () => {
    const container = await AstroContainer.create()
    const result = await container.renderToString(Index)

    expect(result).toContain('Simple Website')
  })
})
```

### Path Aliases in Tests

```typescript
// Available aliases
import Component from '@/components/Component.astro' // src/
import { config } from '~/vitest.config' // root/
```

## ğŸš¢ Production Deployment

### Build Output

```bash
pnpm build
```

Generates:

```text
dist/
â”œâ”€â”€ client/        # Static assets (CSS, JS, images)
â””â”€â”€ server/        # SSR server bundle
    â””â”€â”€ entry.mjs  # Express handler
```

### Running Production Server

```bash
# Default port 3000
pnpm start

# Custom port
PORT=8080 pnpm start
```

> **Note:** Both Gzip and Brotli compression are enabled by default in production for all static and dynamic assets.

### Docker Deployment

From the **monorepo root**:

```bash
# Build image
docker build --target astro-website-runtime -t astro-website .

# Run container
docker run -p 3000:3000 astro-website
```

### Environment Variables

| Variable | Default   | Description |
| -------- | --------- | ----------- |
| `PORT`   | `3000`    | Server port |
| `HOST`   | `0.0.0.0` | Server host |

## âš™ï¸ Configuration

### App Configuration

Edit `src/config.ts` to customize:

```typescript
export const PROJECT_NAME = 'My Website'
export const PROJECT_SHORT_NAME = 'MW'
export const PROJECT_DESCRIPTION = 'My awesome website'
export const PROJECT_LIGHT_BACKGROUND_COLOR = '#ffffff'
export const PROJECT_DARK_BACKGROUND_COLOR = '#000000'
export const TWITTER_HANDLE = '@myhandle'
```

### Astro Configuration

Key settings in `astro.config.ts`:

```typescript
export default defineConfig({
  trailingSlash: 'never', // URL format
  output: 'server', // SSR mode
  adapter: node({
    mode: 'standalone', // Express server
  }),
  integrations: [
    playformCompress({}), // Asset compression
    compressor(), // Additional compression
  ],
  vite: {
    plugins: [
      tailwindcss(), // Tailwind CSS
      paraglideVitePlugin({
        // i18n
        project: '../../.inlang',
        outdir: './src/i18n',
        strategy: ['url', 'preferredLanguage'],
        urlPatterns: routes,
      }),
    ],
  },
})
```

---

**Built with â¤ï¸ using Astro, Paraglide.js, and Tailwind CSS**
